
> archipelago-json@1.0.0 test
> node scripts/test/run-tests.js


Running 1 test using 1 worker

PW DEBUG: Navigating to application with parameters:
  - mode: test-spoilers
  - game: kdl3
  - seed: 1
PW DEBUG: URL: http://localhost:8000/frontend/?mode=test-spoilers&game=kdl3&seed=1
BROWSER LOG (info): [Init - INFO] [Init] loadCombinedModeData started
BROWSER LOG (info): [Init - INFO] [Init] Created stateManager module_config with sourceName: ./presets/kdl3/AP_14089154938208861744/AP_14089154938208861744_rules.json (source: urlOverride)
BROWSER LOG (info): [01:12:31.655] [INFO] [INIT_STEP] Module import and registration phase started
BROWSER LOG (log): [universalLogger] Worker logger initialized
BROWSER LOG (info): [01:12:31.893] [INFO] [INIT_STEP] Module import and registration phase completed
BROWSER LOG (info): [01:12:31.895] [INFO] [INIT_STEP] Golden Layout initialization started
BROWSER LOG (info): [01:12:31.914] [INFO] [INIT_STEP] Golden Layout initialization completed
BROWSER LOG (info): [01:12:31.914] [INFO] [INIT_STEP] Module initialization phase started (4 modules)
BROWSER LOG (info): [01:12:31.915] [INFO] [INIT_STEP] Module initialization phase completed (4 modules)
BROWSER LOG (info): [01:12:31.915] [INFO] [INIT_STEP] Module post-initialization phase started (1 modules)
BROWSER LOG (debug): [Init - DEBUG] [Init _postInitializeSingleModule] Original genericModuleSpecificConfig FOR stateManager: {rulesConfig: Object, sourceName: ./presets/kdl3/AP_14089154938208861744/AP_14089154938208861744_rules.json}
BROWSER LOG (info): [Init - INFO] [Init _postInitializeSingleModule] Derived sourceName for StateManager: ./presets/kdl3/AP_14089154938208861744/AP_14089154938208861744_rules.json (source: urlOverride)
BROWSER LOG (info): [Init - INFO] [Init _postInitializeSingleModule] EXACT configForPostInitialize BEING PASSED to stateManager.postInitialize: {rulesConfig: Object, sourceName: ./presets/kdl3/AP_14089154938208861744/AP_14089154938208861744_rules.json}
BROWSER LOG (info): [01:12:31.929] [INFO] [INIT_STEP] Module post-initialization phase completed (1 modules)
BROWSER LOG (debug): [stateManagerProxy] Snapshot cached from rulesLoadedConfirmation.
PW DEBUG: Page navigation complete (network idle).
PW DEBUG: Starting to wait for __playwrightTestsComplete__ flag on window...
BROWSER LOG (error): [01:12:45.864] [ERROR] [testSpoilerUI] STATE MISMATCH found for: {"type":"state_update","sphere_number":"7.57","player_id":"1"}
BROWSER LOG (error): [01:12:45.865] [ERROR] [testSpoilerUI:ComparisonEngine] STATE MISMATCH found for: {"type":"state_update","sphere_number":"7.57","player_id":"1"}
BROWSER LOG (error): [01:12:45.870] [ERROR] [testSpoilerUI]  > Locations accessible in LOG but NOT in STATE (or checked): Sand Canyon 6 - Professor Hector & R.O.B
BROWSER LOG (error): [01:12:45.870] [ERROR] [testSpoilerUI:ComparisonEngine]  > Locations accessible in LOG but NOT in STATE (or checked): Sand Canyon 6 - Professor Hector & R.O.B
BROWSER LOG (error): [MISMATCH DETAIL] Missing from state (1): [Sand Canyon 6 - Professor Hector & R.O.B]
BROWSER LOG (error): [01:12:45.928] [ERROR] [testSpoilerUI]         Helper function "can_assemble_rob" NOT FOUND in snapshotInterface
BROWSER LOG (error): [01:12:45.945] [ERROR] [testSpoilerUI]     ISSUE: Access rule evaluation failed
BROWSER LOG (error): [01:12:45.951] [ERROR] [testSpoilerUI] Test failed at step 242: Comparison failed for event type 'state_update'.
BROWSER LOG (error): [01:12:45.954] [ERROR] [testSpoilerUI] Mismatch for event 242 (Sphere 7.57): Comparison for state_update at step 242 Failed
BROWSER LOG (warning): [01:12:45.959] [WARN] [testSpoilerUI] Test run halted due to "Stop on first error" being enabled.
BROWSER LOG (error): [01:12:45.962] [ERROR] [testSpoilerUI] Spoiler test completed with 1 mismatch(es). See logs above for details.
BROWSER LOG (error): [01:12:46.805] [ERROR] [TestRunner/test_spoiler_full_run] [spoilers-full-run-1762909952188] Spoiler test failed. Mismatches found in log:
BROWSER LOG (error): [01:12:46.806] [ERROR] [TestRunner/test_spoiler_full_run]   - Mismatch for event 242 (Sphere 7.57): Comparison for state_update at step 242 Failed
BROWSER LOG (error): [01:12:46.806] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM] STATE MISMATCH found for: {"type":"state_update","sphere_number":"7.57","player_id":"1"}
BROWSER LOG (error): [01:12:46.806] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM] > Locations accessible in LOG but NOT in STATE (or checked): Sand Canyon 6 - Professor Hector &amp; R.O.B
BROWSER LOG (error): [01:12:46.807] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM]         Helper function "can_assemble_rob" NOT FOUND in snapshotInterface
BROWSER LOG (error): [01:12:46.807] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM]     ISSUE: Access rule evaluation failed
BROWSER LOG (error): [01:12:46.807] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM] Test failed at step 242: Comparison failed for event type 'state_update'.
BROWSER LOG (error): [01:12:46.807] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM] Mismatch for event 242 (Sphere 7.57): Comparison for state_update at step 242 Failed
BROWSER LOG (error): [01:12:46.807] [ERROR] [TestRunner/test_spoiler_full_run]   - [1:12:45 AM] Spoiler test completed with 1 mismatch(es). See logs above for details.
PW DEBUG: __playwrightTestsComplete__ flag detected as true.
PW DEBUG: __playwrightTestResults__ retrieved from window object.
PW DEBUG: Full in-app test results: {
  "summary": {
    "totalRun": 1,
    "passedCount": 0,
    "failedCount": 1
  },
  "testDetails": [
    {
      "id": "test_spoiler_full_run",
      "name": "Test Spoilers Panel - Full Run",
      "status": "failed",
      "category": "Test Spoilers Panel",
      "startTime": "2025-11-12T01:12:32.188Z",
      "endTime": "2025-11-12T01:12:46.818Z",
      "durationMs": 14630,
      "conditions": [
        {
          "description": "Test started",
          "status": "passed",
          "timestamp": "2025-11-12T01:12:32.189Z"
        },
        {
          "description": "Test Spoilers panel found in DOM",
          "status": "passed",
          "timestamp": "2025-11-12T01:12:32.691Z"
        },
        {
          "description": "\"Load Suggested Log\" button found and enabled",
          "status": "passed",
          "timestamp": "2025-11-12T01:12:32.942Z"
        },
        {
          "description": "\"Run Full Test\" button appeared",
          "status": "passed",
          "timestamp": "2025-11-12T01:12:33.697Z"
        },
        {
          "description": "Full spoiler test completed",
          "status": "passed",
          "timestamp": "2025-11-12T01:12:46.802Z"
        },
        {
          "description": "Spoiler test passed all checks",
          "status": "failed",
          "timestamp": "2025-11-12T01:12:46.805Z"
        }
      ],
      "logs": [
        {
          "message": "[spoilers-full-run-1762909952188] Starting testSpoilersPanelFullRun...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.188Z"
        },
        {
          "message": "Condition: \"Test started\" - PASSED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.189Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Activating testSpoilersPanel panel...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.189Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"Test Spoilers panel initialization\" (timeout: 10000ms, interval: 250ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.189Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"Test Spoilers panel initialization\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.440Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"Test Spoilers panel DOM element\" (timeout: 5000ms, interval: 250ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.440Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"Test Spoilers panel DOM element\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.691Z"
        },
        {
          "message": "Condition: \"Test Spoilers panel found in DOM\" - PASSED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.691Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"\"Load Suggested Log\" button to be available\" (timeout: 10000ms, interval: 250ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.691Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"\"Load Suggested Log\" button to be available\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.942Z"
        },
        {
          "message": "Condition: \"\"Load Suggested Log\" button found and enabled\" - PASSED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.942Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Clicking \"Load Suggested Log\" button...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.942Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"Spoiler log loading completion\" (timeout: 15000ms, interval: 500ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:32.945Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"Spoiler log loading completion\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.446Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"\"Run Full Test\" button to appear\" (timeout: 10000ms, interval: 250ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.446Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"\"Run Full Test\" button to appear\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.697Z"
        },
        {
          "message": "Condition: \"\"Run Full Test\" button appeared\" - PASSED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.697Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Clicking \"Run Full Test\" button...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.697Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"Full spoiler test to start processing\" (timeout: 5000ms, interval: 100ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.700Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"Full spoiler test to start processing\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.800Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Waiting for full spoiler test to complete...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.800Z"
        },
        {
          "message": "[test_spoiler_full_run] Polling for condition: \"Full spoiler test completion with detailed results\" (timeout: 300000ms, interval: 1000ms)...",
          "type": "info",
          "timestamp": "2025-11-12T01:12:33.800Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:34.803Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:35.803Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:36.804Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:37.803Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:38.800Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:39.801Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:40.801Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:41.811Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:42.801Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:43.801Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:44.815Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=false, processedEvents=0/0",
          "type": "info",
          "timestamp": "2025-11-12T01:12:45.804Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Polling: buttonReady=true, hasDetailedResults=true, processedEvents=241/342",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.801Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] DEBUG detailedResults: {\"passed\":false,\"totalEvents\":342,\"processedEvents\":241,\"errorCount\":1,\"sphereCount\":242,\"testLogPath\":\"presets/kdl3/AP_14089154938208861744/AP_14089154938208861744_spheres_log.jsonl\"}",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.801Z"
        },
        {
          "message": "[test_spoiler_full_run] Condition met for: \"Full spoiler test completion with detailed results\".",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.801Z"
        },
        {
          "message": "Condition: \"Full spoiler test completed\" - PASSED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.801Z"
        },
        {
          "message": "Condition: \"Spoiler test passed all checks\" - FAILED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.805Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Spoiler test failed. Mismatches found in log:",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.805Z"
        },
        {
          "message": "  - Mismatch for event 242 (Sphere 7.57): Comparison for state_update at step 242 Failed",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.806Z"
        },
        {
          "message": "  - [1:12:45 AM] STATE MISMATCH found for: {\"type\":\"state_update\",\"sphere_number\":\"7.57\",\"player_id\":\"1\"}",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.806Z"
        },
        {
          "message": "  - [1:12:45 AM] > Locations accessible in LOG but NOT in STATE (or checked): Sand Canyon 6 - Professor Hector &amp; R.O.B",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.806Z"
        },
        {
          "message": "  - [1:12:45 AM]         Helper function \"can_assemble_rob\" NOT FOUND in snapshotInterface",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.807Z"
        },
        {
          "message": "  - [1:12:45 AM]     ISSUE: Access rule evaluation failed",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.807Z"
        },
        {
          "message": "  - [1:12:45 AM] Test failed at step 242: Comparison failed for event type 'state_update'.",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.807Z"
        },
        {
          "message": "  - [1:12:45 AM] Mismatch for event 242 (Sphere 7.57): Comparison for state_update at step 242 Failed",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.807Z"
        },
        {
          "message": "  - [1:12:45 AM] Spoiler test completed with 1 mismatch(es). See logs above for details.",
          "type": "error",
          "timestamp": "2025-11-12T01:12:46.807Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Spoiler test results stored in window.__spoilerTestResults__",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.808Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] Spoiler test results stored in localStorage",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.816Z"
        },
        {
          "message": "[spoilers-full-run-1762909952188] testSpoilersPanelFullRun finished. Overall Result: false.",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.816Z"
        },
        {
          "message": "Test completion signal: FAILED",
          "type": "info",
          "timestamp": "2025-11-12T01:12:46.817Z"
        },
        {
          "message": "No active event listeners to clean up",
          "type": "debug",
          "timestamp": "2025-11-12T01:12:46.817Z"
        },
        {
          "message": "No active event listeners to clean up",
          "type": "debug",
          "timestamp": "2025-11-12T01:12:46.818Z"
        },
        {
          "message": "No active event listeners to clean up",
          "type": "debug",
          "timestamp": "2025-11-12T01:12:46.818Z"
        }
      ]
    }
  ],
  "completedAt": "2025-11-12T01:12:46.919Z"
}
PW DEBUG: Test results saved to: /home/user/Archipelago-CC/test-results/in-app-tests/test-results-2025-11-12T01-12-47.json
  âœ˜  1 tests/e2e/app.spec.js:35:3 â€º Application End-to-End Tests â€º run in-app tests and check results (16.1s)


  1) tests/e2e/app.spec.js:35:3 â€º Application End-to-End Tests â€º run in-app tests and check results 

    Error: [2mexpect([22m[31mreceived[39m[2m).[22mtoBe[2m([22m[32mexpected[39m[2m) // Object.is equality[22m

    Expected: [32m0[39m
    Received: [31m1[39m

      141 |
      142 |     // The test system should complete successfully regardless of whether tests run
    > 143 |     expect(results.summary.failedCount).toBe(0);
          |                                         ^
      144 |     
      145 |     // If tests actually ran, they should pass
      146 |     if (results.summary.totalRun > 0) {
        at /home/user/Archipelago-CC/tests/e2e/app.spec.js:143:41

    Error Context: test-results/app-Application-End-to-End-a086e-app-tests-and-check-results/error-context.md

  1 failed
    tests/e2e/app.spec.js:35:3 â€º Application End-to-End Tests â€º run in-app tests and check results â”€
